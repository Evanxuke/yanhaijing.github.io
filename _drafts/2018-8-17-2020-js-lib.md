---
layout: post
title: 2018年如何写一个现代的JavaScript库
category : javascript
tagline: "原创"
tags : [javascript]
keywords: [javascript]
description: 
---
{% include JB/setup %}

我写过一些[开源项目](https://github.com/yanhaijing)，在开源方面有一些经验，最近开到了阮老师的微博，深有感触，现在一个开源项目涉及的东西确实挺多的，特别是对于新手来说非常不友好

![]({{BLOG_IMG}}529.png)

最近我写了一个[jslib-base](https://github.com/yanhaijing/jslib-base)，旨在从多方面快速帮大家搭建一个标准的js库，本文将已jslib-base为例，介绍写一个开源库的知识

> jslib-base 最好用的js第三方库脚手架，赋能js第三方库开源，让开发一个js库更简单，更专业

## 文档
所谓代码未动，文档先行，文档对于一个项目非常重要，一个项目的文档包括

- README.md
- TODO.md
- CHANGELOG.md
- LICENSE
- doc

### README.md
README是一个项目的门面，应该简单明了的呈现用户最关心的问题，一个开源库的用户包括使用者和贡献者，所以一个文档应该包括项目简介，使用者指南，贡献者指南三部分

项目简介用该简单介绍项目功能，使用场景，兼容性的相关知识，这里重点介绍下徽章，相信大家都见过别人项目中的徽章，如下所示

![]({{BLOG_IMG}}530.png)

徽章通过更直观的方式，将更多的信息呈现出来，还能够提高颜值，有一个网站专门制作各种徽章，可以看[这里](https://shields.io/#/)

这里有一个README的[完整的例子](https://github.com/yanhaijing/jslib-base/blob/master/README.md)

### TODO.md
TODO应该记录项目的未来计划，这对于贡献者和使用者都有很重要的意义，下面是TODO的例子

```
- [X] 已完成
- [ ] 未完成
```

### CHANGELOG.md
CHANGELOG记录项目的变更日志，对项目使用者非常重要，特别是在升级使用版本时，CHANGELOG需要记录项目的版本，发版时间和版本变更记录

```
## 0.1.0 / 2018-10-6

- 新增xxx功能
- 删除xxx功能
- 更改xxx功能
```

### LICENSE
开源项目必须要选择一个协议，因为没有协议的项目是没有人敢使用的，关于不同协议的区别可以看下面这张图（出自阮老师博客），我的建议是选择MIT或者BSD协议

![]({{BLOG_IMG}}531.png)

### doc
开源项目还应该提供详细的使用文档，一份详细文档的每个函数介绍都应该包括如下信息：

```
函数简单介绍

函数详细介绍

函数参数和返回值（要遵守下面的例子的规则）

- param {string} name1 name1描述
- return {string} 返回值描述

举个例子（要包含代码用例）

// 代码

特殊说明，比如特殊情况下会报错等
```
## 构建

## 规范
无规矩不成方圆，特别是对于开源项目，由于会有多人参与，所以大家遵守一份规范会事半功倍

### 编辑器规范
首先可以通过`.editorconfig`来保证缩进、换行的一致性，目前绝大部分浏览器都已经支持，可以看[这里](http://editorconfig.org/)

下面的配置设置在js，css和html中都用空格代替tab，tab为4个空格，使用unix换行符，使用utf8字符集，每个文件结尾添加一个空行

```
root = true

[{*.js,*.css,*.html}]
indent_style = space
indent_size = 4
end_of_line = lf
charset = utf-8
insert_final_newline = true

[{package.json,.*rc,*.yml}]
indent_style = space
indent_size = 2

```

### 代码风格
其次可以通过eslint来保证代码风格一致，关于eslint的安装和配置这里不再展开解释了，在jslib-base中只需要运行下面的命令就可以进行代码校验了，eslint的配置文件位于`config/.eslintrc.js`

```bash
$ npm run lint
```

### 设计规范
eslint只能够保证代码规范，却不能保证提供优秀的接口设计，关于函数接口设计有一些指导规则

参数数量

- 函数的参数个数最多不要超过5个

可选参数

- 可选参数应该放到后面
- 可选参数数量超过三个时，可以使用对象传入
- 可选参数，应该提供默认值

参数校验与类型转换

- 必传参数，如果不传要报错
- 对下列类型要做强制检验，类型不对要报错（object, array, function）
- 对下列类型要做自动转换（number, string, boolean）
- 对于复合类型的内部数据，也要做上面的两个步骤
- 对于number转换后如果为NaN，要做特殊处理（有默认值的赋值为默认值，无默认值的要报错）

参数类型

- 参数尽量使用值类型（简单类型）
- 参数尽量不要使用复杂类型（避免副作用）
- 使用复杂类型时，层级不要过深
- 使用复杂数据类型时，应该进行深拷贝（避免副作用）

函数返回值

- 返回值可返回操作结果（获取接口），操作是否成功（保存接口）
- 返回值的类型要保持一致

- 返回值尽量使用值类型（简单类型）
- 返回值尽量不要使用复杂类型（避免副作用）

### 版本规范
版本应该遵守开源社区通用的[语义化版本](https://semver.org/lang/zh-CN/
)

版本号格式：x.y.z

- x 主版本号，不兼容的改动
- y 次版本号，兼容的改动
- z 修订版本号，bug修复

### Git commit规范
代码的提交应该遵守规范，这里推荐一个[我的规范](https://yanhaijing.com/git/2016/02/17/my-commit-message/)

## 测试

## 可持续集成
如果每次push都能够自动运行单元测试就好了，这样就省去了手动运行的繁琐，好在[travis-ci](https://www.travis-ci.org/
)已经为我们提供了这个功能

用GitHub登录travis-ci，就可以看到自己在GitHub上的项目了，然后需要打开下项目的开关，才能够打开自动集成功能

![]({{BLOG_IMG}}532.png)

第二步，还需要在项目中添加一个文件`.travis.yml`，内容如下，这样就可以在每次push时自动在node 4 6 8版本下运行`npm test`命令，从而实现自动测试的目的

```
language: node_js
node_js:
  - "8"
  - "6"
  - "4"
```

## 其他内容
开源库希望得到用户的反馈，如果对用户提的issue有要求，可以设置一个模版，用来规范github上用户反馈的issue需要制定一些信息

通过提供`.github/ISSUE_TEMPLATE`文件可以给issue提供模版，下面是一个例子，用户提issue时会自动带上如下的提示信息

```
### 问题是什么
问题的具体描述，尽量详细

### 环境
- 手机: 小米6
- 系统：安卓7.1.1
- 浏览器：chrome 61
- jslib-base版本：0.2.0
- 其他版本信息

### 在线例子
如果有请提供在线例子

### 其他
其他信息

```

## jsmini
[jsmini](https://github.com/jsmini)是基于jslib-base的一系列库，jsmini的理念是小而美，并且无第三方依赖，开源了很多能力，能够
助力库开发者

## 总结
本文总结了自己5年来做开源项目的一些经验，希望能够帮助大家，所有介绍的内容都可以在[jslib-base](https://github.com/yanhaijing/jslib-base)里面找到

jslib-base是一个拿来即用脚手架，赋能js第三方库开源，快速开源一个标准的js库
